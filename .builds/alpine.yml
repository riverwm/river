image: alpine/edge
packages:
  - eudev-dev
  - libinput-dev
  - libseat-dev
  - mesa-dev
  - libffi-dev
  - expat-dev
  - hwdata-dev
  - libdisplay-info-dev
  - libxkbcommon-dev
  - xcb-util-image-dev
  - xcb-util-renderutil-dev
  - xcb-util-wm-dev
  - pixman-dev
  - libevdev-dev
  - wayland-dev
  - wayland-protocols
  - xwayland-dev
  - meson
  - scdoc
  - tar
  - wget
  - xz
sources:
  - https://codeberg.org/river/river
  - https://gitlab.freedesktop.org/wlroots/wlroots.git
tasks:
  - install_deps: |
      cd wlroots
      git checkout 0.19.0
      meson setup build --auto-features=enabled -Drenderers=gles2 \
            -Dcolor-management=disabled -Dlibliftoff=disabled \
            -Dexamples=false -Dwerror=false -Db_ndebug=false \
            -Dxcb-errors=disabled --prefix /usr
      sudo ninja -C build/ install
      cd ..

      # Eat Github's resources rather than the Zig Software Foundation's resources!
      wget -nv https://github.com/ifreund/zig-tarball-mirror/releases/download/0.14.0/zig-linux-x86_64-0.14.0.tar.xz
      tar xf zig-linux-x86_64-0.14.0.tar.xz
      sudo mv zig-linux-x86_64-0.14.0/zig /usr/bin/
      sudo mv zig-linux-x86_64-0.14.0/lib /usr/lib/zig
  - build: |
      cd river
      zig build --summary all
  - build_xwayland: |
      cd river
      zig build --summary all -Dxwayland
  - fmt: |
      cd river
      zig fmt --check river/
      zig fmt --check riverctl/
      zig fmt --check rivertile/
      zig fmt --check build.zig
